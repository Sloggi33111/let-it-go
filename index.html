<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Pinterest-Style Image Gallery</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/imagesloaded@5/imagesloaded.pkgd.min.js"></script>
</head>
<body>
    <h1>Welcome to My Image Gallery!</h1>
    <div class="grid" id="grid">
        <div class="grid-sizer"></div>
    </div>
    
    <script>
        // 检查 Masonry 和 imagesLoaded 是否加载
        if (!window.Masonry || !window.imagesLoaded) {
            console.error('Masonry or imagesLoaded not loaded!');
            alert('Failed to load required libraries. Please check your network.');
        }

        // 动态加载图片
        fetch('images.json')
            .then(response => {
                if (!response.ok) throw new Error('Failed to load images.json: ' + response.status);
                return response.json();
            })
            .then(images => {
                if (!images.length) console.warn('images.json is empty!');
                
                const grid = document.getElementById('grid');
                
                images.forEach(src => {
                    const item = document.createElement('div');
                    item.className = 'grid-item';
                    
                    const img = document.createElement('img');
                    img.src = src;
                    img.alt = 'Image';
                    img.loading = 'lazy';
                    
                    // 点击复制文件名
                    img.onclick = () => {
                        const filename = src.split('/').pop();
                        navigator.clipboard.writeText(filename)
                            .then(() => alert('Copied filename to clipboard: ' + filename))
                            .catch(err => console.error('Failed to copy: ', err));
                    };
                    
                    img.onerror = () => console.error('Failed to load image: ' + src);
                    item.appendChild(img);
                    grid.appendChild(item);
                });
                
                // 等待图片加载后初始化 Masonry
                imagesLoaded(grid, { background: '.grid-item' }, function() {
                    console.log('Images loaded, initializing Masonry');
                    new Masonry(grid, {
                        itemSelector: '.grid-item',
                        columnWidth: '.grid-sizer',
                        gutter: 10,
                        percentPosition: true,
                        stagger: 30,
                        fitWidth: true
                    });
                });
            })
            .catch(error => {
                console.error('Error loading images:', error);
                alert('Failed to load images. Check console for details.');
            });
    </script>
</body>
</html>
